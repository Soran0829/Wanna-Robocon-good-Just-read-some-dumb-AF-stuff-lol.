# Part3 STM32開発環境の導入とプロジェクト作成

このパートでは、STM32マイクロコントローラ用の統合開発環境「STM32CubeIDE」のインストールと、新規プロジェクトの作成方法について説明します。

## 1. STM32CubeIDEのインストール

STM32CubeIDEは、STMicroelectronicsが提供する公式の統合開発環境です。マイコンの初期設定、コード記述、コンパイル、デバッグのすべてをこのソフトウェア一つで行うことができます。

1.  **インストーラのダウンロード**
    *   [STMicroelectronicsの公式サイト](https://www.st.com/ja/development-tools/stm32cubeide.html)にアクセスします。
    *   「最新版を入手」ボタンをクリックし、お使いのOS（Windows, macOS, Linux）に合ったインストーラをダウンロードします。ダウンロードにはアカウント登録（無料）が必要です。

2.  **インストール**
    *   ダウンロードしたインストーラを実行します。
    *   ライセンス契約に同意し、基本的にデフォルト設定のまま「Next」をクリックしてインストールを進めます。
    *   インストール中にST-LINKデバッガ用のドライバのインストールを求められた場合は、許可してください。
    *   インストールが完了したら、STM32CubeIDEを起動します。

3.  **ワークスペースの選択**
    *   初回起動時に「Workspace」（プロジェクトを保存するフォルダ）の場所を聞かれます。任意のフォルダを指定し、「Launch」をクリックしてください。

## 2. 新規プロジェクトの作成

1.  **STM32プロジェクトの開始**
    *   STM32CubeIDEのメニューバーから `File > New > STM32 Project` を選択します。

2.  **ターゲットマイコンの選択**
    *   「Target Selection」ウィンドウが開きます。ここで開発に使用するSTM32マイコンを選択します。
    *   **Board Selector** タブを選択し、検索ボックスにNUCLEOやDiscoveryなどの評価ボード名を入力して、該当するボードを選択し、「Next」をクリックします。

3.  **プロジェクトの設定**
    *   **Project Name:** プロジェクトの名前を入力します。（例: `MotorTest`）
    *   **Language:** `C`を選択します。
    *   **Binary Type:** `Executable`を選択します。
    *   **Project Type:** `STM32Cube`を選択します。
    *   設定が完了したら「Finish」をクリックします。

4.  **ペリフェラルの初期化**
    *   「Initialize all peripherals with their default Mode?」というダイアログが表示されたら、「Yes」をクリックします。

## 3. CubeMXによる初期コード生成

プロジェクトが作成されると、`.ioc`という拡張子のファイルが開きます。これはGUI操作でマイコンのペリフェラル（GPIO, UART, SPI, タイマなど）の設定を行うための画面です。

1.  **ピン設定とペリフェラル有効化**
    *   **Pinout & Configuration** タブで、マイコンのピン配置図が表示されます。
    *   左側のペインから使用したいペリフェラル（例: `TIM1`, `USART2`）を選択し、Modeを有効化（例: `Internal Clock`, `Asynchronous`）します。
    *   有効化すると、対応するピンが緑色に変わります。

2.  **クロック設定**
    *   **Clock Configuration** タブで、マイコンの動作クロックを設定します。多くの場合、自動設定機能で最適な値に設定できますが、必要に応じて手動で調整します。

3.  **コード生成**
    *   ペリフェラルの設定が完了したら、`Ctrl+S`で保存します。
    *   「Do you want to generate Code?」と聞かれたら、「Yes」をクリックします。
    *   設定に基づいた初期化コードが自動で生成されます。

## 4. プログラムの記述とビルド

1.  **コードの記述**
    *   左側の「Project Explorer」から `[プロジェクト名] > Core > Src > main.c` を開きます。
    *   `main`関数内の`while(1)`ループの中に、自分の処理を記述します。
    *   **注意:** コードは必ず `/* USER CODE BEGIN ... */` と `/* USER CODE END ... */` の間に記述してください。この外側に記述したコードは、再度コード生成を行った際に上書きされて消えてしまいます。

2.  **ビルド（コンパイル）**
    *   メニューバーのハンマー（ビルド）アイコンをクリックするか、`Project > Build All` を選択してプログラムをビルドします。
    *   画面下部の「Console」ウィンドウにエラーが表示されなければビルド成功です。

これで、STM32の開発を始める準備が整いました。次はデバッガ（ST-LINK）を使ってマイコンにプログラムを書き込み、デバッグを行います。

